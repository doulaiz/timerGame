<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Timer Game</title>
   <style>
      body {
         margin: 0;
         height: 100vh;
         background: #222;
         transition: background 0.2s;
      }

      .flash {
         animation: flash-bg 0.2s alternate 3;
      }

      @keyframes flash-bg {
         from {
            background: #222;
         }

         to {
            background: #ffba3b;
         }
      }

      .timeout {
         background: #fd5151 !important;
      }

      .center-message {
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         color: #fff;
         font-size: 2rem;
         text-align: center;
         user-select: none;
      }

      .ripple {
         position: absolute;
         border-radius: 50%;
         transform: scale(0);
         animation: ripple-anim 0.6s linear;
         background: rgba(122, 238, 122, 0.5);
         pointer-events: none;
         z-index: 9999;
      }

      @keyframes ripple-anim {
         to {
            transform: scale(2);
            opacity: 0;
         }
      }
   </style>
</head>

<body>
   <button id="settingsBtn"
      style="position:fixed;top:20px;right:20px;z-index:10000;padding:8px 14px;border:none;border-radius:6px;background:#444;color:#fff;cursor:pointer;font-size:1.1rem;">⏱️</button>
   <div class="center-message" id="message">Ready</div>
   <div id="modalOverlay"
      style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:10001;align-items:center;justify-content:center;">
      <div
         style="background:#222;padding:32px 24px;border-radius:12px;box-shadow:0 2px 16px #0006;min-width:260px;max-width:90vw;text-align:center;position:relative;">
         <button id="closeModal"
            style="position:absolute;top:10px;right:10px;background:none;border:none;color:#fff;font-size:1.3rem;cursor:pointer;">✖</button>
         <h2 style="color:#fff;margin-top:0;">Timer Duration</h2>
         <input id="durationInput" type="number" min="5" max="600" value="30"
            style="width:80px;font-size:1.2rem;padding:4px 8px;border-radius:4px;border:1px solid #888;" />
         <span style="color:#fff;font-size:1.1rem;">seconds</span>
         <br><br>
         <button id="saveDuration"
            style="padding:6px 18px;border:none;border-radius:6px;background:#4caf50;color:#fff;font-size:1.1rem;cursor:pointer;">Save</button>
      </div>
   </div>
   <script>
      let timer = null;
      let timerDuration = 30;
      let timeLeft = 30;
      let flashing = false;
      let afterTimeout = false;
      const flashThreshold = 5; // seconds before end to start flashing
      const message = document.getElementById('message');
      const body = document.body;
      const settingsBtn = document.getElementById('settingsBtn');
      const modalOverlay = document.getElementById('modalOverlay');
      const closeModal = document.getElementById('closeModal');
      const durationInput = document.getElementById('durationInput');
      const saveDuration = document.getElementById('saveDuration');

      function updateTitle() {
         if (timeLeft > 0) {
            document.title = `⏳ ${timeLeft}`;
         } else {
            document.title = '⏰';
         }
      }

      function resetTimer() {
         if (timer) clearInterval(timer);
         timeLeft = timerDuration;
         body.classList.remove('timeout', 'flash');
         message.textContent = '';
         updateTitle();
         startTimer();
      }

      function startTimer() {
         updateTitle();
         timer = setInterval(() => {
            timeLeft--;
            updateTitle();
            if (timeLeft <= flashThreshold && timeLeft > 0 && !flashing) {
               flashing = true;
               body.classList.add('flash');
               setTimeout(() => {
                  body.classList.remove('flash');
                  flashing = false;
               }, 600);
            }
            if (timeLeft <= 0) {
               clearInterval(timer);
               body.classList.add('timeout');
               message.textContent = '';
               updateTitle();
               afterTimeout = false;
            }
         }, 1000);
      }

      body.addEventListener('click', (e) => {
         // Ripple effect
         const ripple = document.createElement('span');
         ripple.className = 'ripple';
         const size = Math.max(window.innerWidth, window.innerHeight);
         ripple.style.width = ripple.style.height = size + 'px';
         ripple.style.left = (e.clientX - size / 2) + 'px';
         ripple.style.top = (e.clientY - size / 2) + 'px';
         ripple.style.position = 'fixed';
         document.body.appendChild(ripple);
         ripple.addEventListener('animationend', () => ripple.remove());

         if (timeLeft <= 0) {
            if (!afterTimeout) {
               // First click after timeout: reset to Ready
               message.textContent = 'Ready';
               body.classList.remove('timeout');
               afterTimeout = true;
            } else {
               // Second click: restart timer
               afterTimeout = false;
               resetTimer();
            }
            return;
         }
         // Normal click: always restart timer
         resetTimer();
      });
      // Modal logic
      settingsBtn.addEventListener('click', (e) => {
         e.stopPropagation();
         durationInput.value = timerDuration;
         modalOverlay.style.display = 'flex';
      });
      closeModal.addEventListener('click', (e) => {
         e.stopPropagation();
         modalOverlay.style.display = 'none';
      });
      modalOverlay.addEventListener('click', (e) => {
         if (e.target === modalOverlay) modalOverlay.style.display = 'none';
      });
      saveDuration.addEventListener('click', (e) => {
         e.stopPropagation();
         let val = parseInt(durationInput.value, 10);
         if (isNaN(val) || val < 5) val = 5;
         if (val > 600) val = 600;
         timerDuration = val;
         modalOverlay.style.display = 'none';
         resetTimer();
      });
      // Set initial title
      document.title = 'Timer Game';
   </script>
</body>

</html>